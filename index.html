<html>
<head>
	<title>console test</title>
    <script src="jquery-1.9.1.min.js"></script>
    <script src="js/numeral.min.js"></script>
    <script src="js/moment.min.js"></script>
    <script src="php-build/calx-build.php"></script>
    <!--<script src="jquery-calx-2.0.0.min.js"></script>-->
    <style>
        thead > tr > td{
            text-align:center;
            background: #eee;
        }

        td.num{
            background: #eee;
            width: 25px;
            text-align: center
        }

        input[type="text"]{
            width: 120px;
        }

        h5{
            text-align: center;
        }
    </style>
</head>
<body>
    <form id="sheet1">
        <table>
            <thead>
                <tr>
                    <td>&nbsp;</td>
                    <td>A</td>
                    <td>B</td>
                    <td>C</td>
                    <td>D</td>
                    <td>E</td>
                    <td>F</td>
                    <td><span style="font-weight:bold">Test your formula here</span></td>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="num">1</td>
                    <td><input type="text" data-cell="A1"></td>
                    <td><input type="text" data-cell="B1"></td>
                    <td><input type="text" data-cell="C1"></td>
                    <td><input type="text" data-cell="D1"></td>
                    <td><input type="text" data-cell="E1"></td>
                    <td><input type="text" data-cell="F1"></td>
                    <td rowspan="4" style="vertical-align:top">
                        <table>
                            <tr>
                                <td><label for="formula_test">Formula :</label></td>
                                <td><input type="text" style="width:100%" id="formula_test"></td>
                            </tr>
                            <tr>
                                <td><label for="formula_test">Format :</label></td>
                                <td><input type="text" style="width:100%" id="format_test"></td>
                            </tr>
                            <tr>
                                <td colspan="2" style="text-align:center"><button id="formula_button">Apply!</button></td>
                            </tr>
                            <tr>
                                <td colspan="2"><input data-cell="G1" type="text" style="width:100%"></td>
                            </tr>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td class="num">2</td>
                    <td><input type="text" data-cell="A2" data-format="$ 0,0[.]00"></td>
                    <td><input type="text" data-cell="B2"></td>
                    <td><input type="text" data-cell="C2"></td>
                    <td><input type="text" data-cell="D2"></td>
                    <td><input type="text" data-cell="E2"></td>
                    <td><input type="text" data-cell="F2"></td>
                </tr>
                <tr>
                    <td class="num">3</td>
                    <td><input type="text" data-cell="A3"></td>
                    <td><input type="text" data-cell="B3"></td>
                    <td><input type="text" data-cell="C3"></td>
                    <td><input type="text" data-cell="D3"></td>
                    <td><input type="text" data-cell="E3"></td>
                    <td><input type="text" data-cell="F3"></td>
                </tr>
                <tr>
                    <td class="num">4</td>
                    <td><input type="text" data-cell="A4"></td>
                    <td><input type="text" data-cell="B4"></td>
                    <td><input type="text" data-cell="C4"></td>
                    <td><input type="text" data-cell="D4"></td>
                    <td><input type="text" data-cell="E4"></td>
                    <td><input type="text" data-cell="F4"></td>
                </tr>
                <tr>
                    <td class="num">5</td>
                    <td><input type="text" data-cell="A5"></td>
                    <td><input type="text" data-cell="B5"></td>
                    <td><input type="text" data-cell="C5"></td>
                    <td><input type="text" data-cell="D5"></td>
                    <td><input type="text" data-cell="E5"></td>
                    <td><input type="text" data-cell="F5"></td>
                </tr>
                <tr>
                    <td class="num">6</td>
                    <td><input type="text" data-cell="A6"></td>
                    <td><input type="text" data-cell="B6"></td>
                    <td><input type="text" data-cell="C6"></td>
                    <td><input type="text" data-cell="D6"></td>
                    <td><input type="text" data-cell="E6"></td>
                    <td><input type="text" data-cell="F6"></td>
                </tr>
            </tbody>
        </table>
    </form>
    <form id="sheet2">

        <table>
            <tr>
                <td><label for="formula_test2">Formula :</label></td>
                <td><input type="text" style="width:100%" id="formula_test2"></td>
            </tr>
            <tr>
                <td><label for="formula_test2">Format :</label></td>
                <td><input type="text" style="width:100%" id="format_test2"></td>
            </tr>
            <tr>
                <td colspan="2" style="text-align:center"><button id="formula_button2">Apply!</button></td>
            </tr>
            <tr>
                <td colspan="2"><input data-cell="ZZ256" type="text" style="width:100%"></td>
            </tr>
        </table>
        <table id="tbl2">

            <thead>
                <tr></tr>
            </thead>
            <tbody></tbody>
        </table>
    </form>
    <script type="text/javascript">

        function toNum(chr) {
            chr = chr.split('');
            var base = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(''),
                i, j, result = 0;

            for (i = 0, j = chr.length - 1; i < chr.length; i += 1, j -= 1) {
                result += Math.pow(base.length, j) * (base.indexOf(chr[i]) + 1);
            }
            return result;
        }

        function toChr(num) {
            var s = "";
            num = num - 1;
            while (num >= 0) {
                s = String.fromCharCode(num % 26 + 97) + s;
                num = Math.floor(num / 26) - 1;
            }
            return s.toUpperCase();
        }


        function getRandomArbitrary(min, max) {
            return Math.random() * (max - min) + min;
        }

        function cellrange(addressStart, addressStop) {
            var alpha = /[A-Z]+/,
                num = /[0-9]+/,
                cellStart = addressStart.toUpperCase(),
                cellStop = addressStop.toUpperCase(),
                alphaAxisStart = toNum(cellStart.match(alpha)[0]),
                alphaAxisStop = toNum(cellStop.match(alpha)[0]),
                numAxisStart = parseInt(cellStart.match(num)[0], 10),
                numAxisStop = parseInt(cellStop.match(num)[0], 10),
                cellRange = [],
                cellAddress,
                row, col, tr, td,
                table = $('#tbl2 tbody'),
                thead = $('#tbl2 thead tr'),
                tbody = '';

            table.html('');
            thead.html('<td></td>');

            for (row = numAxisStart; row <= numAxisStop; row++) {
                tr += '<tr>';
                tr += '<td class="num">'+row+'</td>';
                for (col = alphaAxisStart; col <= alphaAxisStop; col++) {
                  if(row == 1){
                    thead.append('<td>'+this.toChr(col)+'</td>');
                  }
                    cellAddress = this.toChr(row) + col;
                    tr += '<td><input type="text" data-cell="'+cellAddress+'" value="'+getRandomArbitrary(0, 100)+'"></td>';
                }
                tr+= '</tr>';
            }

            table.html(tr);
        }

        console.time('cell-rendering');

        cellrange('A1', 'BF190');

        console.timeEnd('cell-rendering');

        console.time('calx-rendering');
        $('#sheet1, #sheet2').calx({
            'default' : 0,
            'autoCalculate' : true
        });
        console.timeEnd('calx-rendering');

        $('#formula_button').click(function(e){
            e.preventDefault();
            var cell = $('#sheet1').calx('getCell', 'G1');
            cell.setFormat($('#format_test').val());
            cell.setFormula($('#formula_test').val());
        });

        $('#formula_button2').click(function(e){
            e.preventDefault();
            var cell = $('#sheet2').calx('getCell', 'ZZ256');
            cell.setFormat($('#format_test2').val());
            cell.setFormula($('#formula_test2').val());
        });

    </script>

</body>
</html>